/*! mpulse v1.1.0 */

!function(e){"use strict";function n(n,t){r||("function"==typeof XDomainRequest||"object"==typeof XDomainRequest?(d=!0,r=function(){return new XDomainRequest}):"function"==typeof XMLHttpRequest||"object"==typeof XMLHttpRequest?r=function(){return new XMLHttpRequest}:"function"==typeof require?r=function(){return new(0,require("xmlhttprequest").XMLHttpRequest)}:e&&void 0!==e.ActiveXObject&&(r=function(){return new e.ActiveXObject("Microsoft.XMLHTTP")}));var o=r();"function"==typeof t&&(d?o.onload=function(){t(o.responseText)}:o.onreadystatechange=function(){4===o.readyState&&t(o.responseText)}),o.open("GET",n,!0),o.send()}function t(e){"object"==typeof console&&"function"==typeof console.warn&&console.warn("mPulse: "+e)}function o(o,i,r){function c(n){return-1!==n.indexOf("http://")||-1!==n.indexOf("https://")?n:(A?n="https:"+n:void 0===e?-1===n.indexOf("http:")&&(n="http:"+n):void 0!==e&&"file:"===e.location.protocol&&-1===n.indexOf("http:")&&(n="http:"+n),n)}function d(){var e=I,n=+new Date;return-1!==e.indexOf("?")?e+="&":e+="?",e+="key="+R,e+="&t="+n,e+="&s="+function(e,n,o){if("undefined"==typeof CryptoJS||"function"!=typeof CryptoJS.HmacSHA256)return t("CryptoJS libraries not found!  mpulse.js will not work."),"";var i="key="+e+"&t="+o;return CryptoJS.HmacSHA256(i,n).toString()}(R,B,n),c(e)}function g(e){try{var n=JSON.parse(e);for(var t in n)n.hasOwnProperty(t)&&(L[t]=n[t])}catch(e){return void(C=!1)}if(J||T(L.session_id),z={},U={},_={},L.PageParams){var o=L.PageParams.customMetrics,i=L.PageParams.customTimers,r=L.PageParams.customDimensions;if(o)for(p=0;p<o.length;p++){var a=o[p];z[a.name]=a.label}if(i)for(p=0;p<i.length;p++){var u=i[p];U[u.name]=u.label}if(r)for(p=0;p<r.length;p++){var c=r[p];_[c.name]=c.label}}C=!0,k=!0,setTimeout(l,f),s(h)}function l(){if(""!==I){var e=d();k&&(e+="&r="),n(e,g)}}function y(e,n,t){q.push({type:e,name:n,value:t,group:j,ab:H,dimensions:function(){var e={};for(var n in G)G.hasOwnProperty(n)&&(e[n]=G[n]);return e}(),when:+new Date})}function h(e){if(0!==q.length)if(C){var n=q.shift(),o=n.type,i=n.name,r=n.value,f={};"boolean"!=typeof n.group&&(f["h.pg"]=n.group),"boolean"!=typeof n.ab&&(f["h.ab"]=n.ab),f["rt.tstart"]=f["rt.end"]=n.when;for(var u in n.dimensions)n.dimensions.hasOwnProperty(u)&&(void 0!==_[u]?f[_[u]]=n.dimensions[u]:t("Custom Dimension '"+u+"' is not defined"));"metric"===o?void 0!==z[i]?(f[z[i]]=r,x(f)):t("Custom Metric '"+i+"' is not defined"):"timer"===o&&(void 0!==U[i]?(f.t_other=U[i]+"|"+r,x(f)):t("Custom Timer '"+i+"' is not defined")),s(h)}else X&&!e||(X=!0,setTimeout(function(){h(!0)},a))}function x(e){e.d=L.site_domain,e["h.key"]=L["h.key"],e["h.d"]=L["h.d"],e["h.cr"]=L["h.cr"],e["h.t"]=L["h.t"],e["http.initiator"]="api",e["rt.start"]="api",!1!==J&&(e["rt.si"]=J,e["rt.ss"]=Y,e["rt.sl"]=E),e.api=1,e["api.v"]=2,e["api.l"]="js",e["api.lv"]=u,D("before_beacon",e);var t=[];for(var o in e)e.hasOwnProperty(o)&&t.push(encodeURIComponent(o)+"="+(void 0===e[o]||null===e[o]?"":encodeURIComponent(e[o])));var i=c(L.beacon_url),r=i+(i.indexOf("?")>-1?"&":"?")+t.join("&");D("beacon",e),n(r)}function b(e,n){return"string"!=typeof e?-1:"number"!=typeof n||n<0?-1:(n=Math.round(n),y("timer",e,n),s(h),n)}function S(e){void 0!==e&&void 0!==G[e]&&delete G[e]}function w(e){"string"!=typeof e&&"number"!=typeof e||("number"==typeof e&&(e=""+e),J=e)}function O(){return J}function T(e){return w(e||"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var n=16*Math.random()|0;return("x"===e?n:3&n|8).toString(16)})),P(0),M(v()),O()}function P(e){"number"!=typeof e||e<0||(E=e)}function M(e){"number"!=typeof e||e<0||(Y=e)}function D(e,n){for(var t=0;t<Z[e].length;t++)Z[e][t](n)}r=r||{};var R=o,B=i,I="//c.go-mpulse.net/api/v2/config.json",A=!1,L={},k=!1,C=!1,q=[],X=!1,j=!1,H=!1,G={},_={},J=!1,z={},N={},U={},K=-1,Y=v(),E=0,Z={};for(p=0;p<m.length;p++)Z[m[p]]=[];void 0!==r.configUrl&&(I=r.configUrl),r.forceSSL&&(A=!0),l();return{startTimer:function(e){return"string"!=typeof e?-1:(K++,N[K]={time:v(),name:e},K)},stopTimer:function(e){if("number"!=typeof e||e<0)return-1;var n=N[e],t=0;return n?(t=Math.round(v()-n.time),b(n.name,t),delete N[e],t):-1},sendTimer:b,sendMetric:function(e,n){"string"==typeof e&&(void 0!==n&&"number"!=typeof n||(void 0===n&&(n=1),y("metric",e,n),s(h)))},setPageGroup:function(e){"string"==typeof e&&(j=e)},getPageGroup:function(){return j},resetPageGroup:function(){j=!1},setABTest:function(e){return"string"==typeof e&&!1!==/^[a-zA-Z0-9_ -]{1,25}$/.test(e)&&(H=e,!0)},getABTest:function(){return H},resetABTest:function(){H=!1},setDimension:function(e,n){void 0!==e&&(void 0!==n?G[e]=n:S(e))},resetDimension:S,setSessionID:w,getSessionID:O,startSession:T,incrementSessionLength:function(){E++},setSessionLength:P,getSessionLength:function(){return E},setSessionStart:M,getSessionStart:function(){return Y},transferBoomerangSession:function(n){return void 0===n&&void 0!==e&&(n=e),!!(void 0!==n&&n.BOOMR&&n.BOOMR.session&&n.BOOMR.session.ID&&n.BOOMR.session.start&&n.BOOMR.session.length)&&(w(n.BOOMR.session.ID+"-"+Math.round(n.BOOMR.session.start/1e3).toString(36)),P(n.BOOMR.session.length),M(n.BOOMR.session.start),!0)},subscribe:function(e,n){Z.hasOwnProperty(e)&&"function"==typeof n&&Z[e].push(n)},parseConfig:g}}function i(){}var r,s,f=3e5,a=5e3,u="1.1.0",c=["startTimer","stopTimer","sendTimer","sendMetric","setPageGroup","getPageGroup","resetPageGroup","setABTest","getABTest","resetABTest","setDimension","resetDimension","setSessionID","getSessionID","startSession","incrementSessionLength","setSessionLength","getSessionLength","setSessionStart","getSessionStart","transferBoomerangSession","subscribe"],m=["before_beacon","beacon"],p=0,d=!1,v=!1,g=+new Date;if(s="undefined"!=typeof process&&"function"==typeof process.nextTick?process.nextTick.bind(process):void 0!==e?e.setImmediate?e.setImmediate.bind(e):e.msSetImmediate?e.msSetImmediate.bind(e):e.webkitSetImmediate?e.webkitSetImmediate.bind(e):e.mozSetImmediate?e.mozSetImmediate.bind(e):function(e){setTimeout(e,10)}:function(e){setTimeout(e,10)},void 0!==e)if(void 0!==e.performance&&"function"==typeof e.performance.now)v=e.performance.now.bind(e.performance);else if(void 0!==e.performance){var l=["webkitNow","msNow","mozNow"];for(p=0;p<l.length;p++)if("function"==typeof e.performance[l[p]]){v=e.performance[l[p]];break}}void 0!==e&&"performance"in e&&e.performance&&e.performance.timing&&e.performance.timing.navigationStart&&(g=e.performance.timing.navigationStart),v||(v="undefined"!=typeof Date&&Date.now?function(){return Date.now()-g}:function(){return+new Date-g});var y,h,x,b=!1,S={};for(void 0!==e&&(x=(h=e).mPulse),y={version:u,noConflict:function(){return h.mPulse=x,y},init:function(e,n,i){if(i=i||{},void 0!==e){if(void 0!==n){if(void 0!==i.name&&void 0!==S[i.name])return S[i.name];var r=o(e,n,i);if(!1===b){b=r;for(var s=0;s<c.length;s++){var f=c[s];y[f]=b[f]}}return void 0!==i.name&&(S[i.name]=r),r}t("init(): You need to specify a secretKey")}else t("init(): You need to specify an apiKey")},getApp:function(e){return S[e]},stop:function(e){void 0!==S[e]&&delete S[e]},now:v},p=0;p<c.length;p++)y[c[p]]=i;"undefined"!=typeof module&&module.exports?module.exports=y:void 0!==h&&(h.mPulse=y)}("undefined"!=typeof window?window:void 0);
//# sourceMappingURL=mpulse.min.js.map